<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    button {
      margin: 5px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }
    #add-product-form {
      margin: 20px 0;
    }
    #add-product-form input {
      margin: 5px;
      padding: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>Inventario</h1>

  <button onclick="window.location.href='index.html'">Volver a la pantalla principal</button>

  <!-- Tabla para mostrar productos -->
  <table>
    <thead>
      <tr>
        <th>Cantidad</th>
        <th>Item</th>
        <th>Modelo</th>
        <th>Marca</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="inventario-tabla">
      <!-- Los productos se cargarán dinámicamente aquí -->
    </tbody>
  </table>

  <!-- Formulario para agregar productos -->
  <div id="add-product-form">
    <h3>Agregar Nuevo Producto</h3>
    <input type="number" id="new-cantidad" placeholder="Cantidad" min="1" required>
    <input type="text" id="new-item" placeholder="Item" required>
    <input type="text" id="new-modelo" placeholder="Modelo" required>
    <input type="text" id="new-marca" placeholder="Marca" required>
    <button onclick="agregarProducto()">Agregar Producto</button>
  </div>

  <!-- Modal de Edición -->
  <div id="modalEdicion" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border: 1px solid #ccc; width: 300px;">
    <h3>Editar Producto</h3>
    <label for="edit-cantidad">Cantidad:</label>
    <input type="number" id="edit-cantidad" required><br>
    
    <label for="edit-item">Item:</label>
    <input type="text" id="edit-item" required><br>

    <label for="edit-modelo">Modelo:</label>
    <input type="text" id="edit-modelo" required><br>

    <label for="edit-marca">Marca:</label>
    <input type="text" id="edit-marca" required><br>

    <button onclick="guardarEdicion()">Guardar cambios</button>
    <button onclick="cerrarModal()">Cancelar</button>
  </div>


  <script>
    let inventario = [];
  
    // Cargar inventario al cargar la página
    window.onload = () => {
      fetch('inventario.json')
        .then(response => response.json())
        .then(data => {
          inventario = data;
          actualizarTabla();
        })
        .catch(error => {
          console.error('Error al cargar el inventario:', error);
        });
    };
  
    // Actualizar la tabla de inventario
    function actualizarTabla() {
      const tabla = document.getElementById('inventario-tabla');
      tabla.innerHTML = ''; // Limpiar tabla
      inventario.forEach((producto, index) => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${producto.cant}</td>
          <td>${producto.item}</td>
          <td>${producto.modelo}</td>
          <td>${producto.marca}</td>
          <td>
            <button onclick="editarProducto(${index})">Editar</button>
            <button onclick="eliminarProducto(${index})">Eliminar</button>
          </td>
        `;
        tabla.appendChild(fila);
      });
    }
  
    // Función para agregar un nuevo producto
    function agregarProducto() {
      const cantidad = document.getElementById('new-cantidad').value;
      const item = document.getElementById('new-item').value;
      const modelo = document.getElementById('new-modelo').value;
      const marca = document.getElementById('new-marca').value;
  
      if (!cantidad || !item || !modelo || !marca) {
        alert('Por favor, completa todos los campos.');
        return;
      }
  
      inventario.push({
        cant: cantidad,
        item,
        modelo,
        marca
      });
  
      guardarInventario();
      actualizarTabla();
  
      // Limpiar campos del formulario
      document.getElementById('new-cantidad').value = '';
      document.getElementById('new-item').value = '';
      document.getElementById('new-modelo').value = '';
      document.getElementById('new-marca').value = '';
    }
  
    // Función para editar un producto
    function editarProducto(index) {
      const producto = inventario[index];
      
      // Mostrar el modal
      document.getElementById('modalEdicion').style.display = 'block';
      
      // Rellenar los campos del modal con los valores del producto
      document.getElementById('edit-cantidad').value = producto.cant;
      document.getElementById('edit-item').value = producto.item;
      document.getElementById('edit-modelo').value = producto.modelo;
      document.getElementById('edit-marca').value = producto.marca;

      // Almacenar el índice del producto en una variable global para usarlo al guardar los cambios
      window.productoEditando = index;
    }

    // Función para guardar la edición del producto
    function guardarEdicion() {
      const cantidad = document.getElementById('edit-cantidad').value;
      const item = document.getElementById('edit-item').value;
      const modelo = document.getElementById('edit-modelo').value;
      const marca = document.getElementById('edit-marca').value;
      
      // Verificar que todos los campos estén completos
      if (!cantidad || !item || !modelo || !marca) {
        alert('Por favor, completa todos los campos.');
        return;
      }

      // Actualizar el producto en el inventario
      inventario[window.productoEditando] = {
        cant: cantidad,
        item,
        modelo,
        marca
      };

      // Guardar inventario y actualizar la tabla
      guardarInventario();
      actualizarTabla();

      // Cerrar el modal
      cerrarModal();
    }

    // Función para cerrar el modal
    function cerrarModal() {
      document.getElementById('modalEdicion').style.display = 'none';
    }

  
    // Función para eliminar un producto
    function eliminarProducto(index) {
      if (confirm('¿Estás seguro de que deseas eliminar este producto?')) {
        inventario.splice(index, 1);
        guardarInventario();
        actualizarTabla();
      }
    }
  
    // Guardar inventario en el archivo JSON
    function guardarInventario() {
      if (window.electron && window.electron.ipcRenderer) {
        window.electron.ipcRenderer.send('guardar-inventario', inventario);

        window.electron.ipcRenderer.once('guardar-inventario-exito', () => {
          console.log('El inventario se guardó correctamente.');
        });

        window.electron.ipcRenderer.once('guardar-inventario-error', (message) => {
          alert('Error al guardar el inventario: ' + message);
        });
      } else {
        console.warn('Electron no está disponible.');
      }

    }
  </script>
</body>
</html>
